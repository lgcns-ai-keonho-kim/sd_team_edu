# 02. 프롬프트 구성 요소와 템플릿

## 이 챕터의 목표

- 프롬프트를 구성하는 핵심 요소를 세분화해 이해한다.
- 재사용 가능한 프롬프트 템플릿을 설계하는 방법을 익힌다.
- 예시(Few-shot)를 언제, 어떻게 넣을지 판단한다.

---

## 1. 구성 요소를 세분화해야 하는 이유

초보자들이 가장 많이 하는 실수는 **모든 정보를 한 줄에 몰아넣는 것**입니다.

프롬프트는 결국 텍스트이지만, 내부적으로는 다음과 같은 **구조**가 있습니다.

- **역할(Role)**: 모델이 어떤 관점으로 답할지
- **목표(Task)**: 정확히 어떤 작업을 수행할지
- **입력(Context)**: 판단에 필요한 데이터
- **출력 형식(Output)**: 파싱 가능한 포맷
- **예시(Examples)**: 원하는 출력 스타일을 고정

이 구조를 분리하면 다음이 쉬워집니다.

- 재사용(다른 입력에도 동일 프롬프트 사용)
- 디버깅(어떤 부분이 문제인지 찾기 쉬움)
- 테스트(입력과 출력 형식을 명확히 검증 가능)

---

## 2. 예시(Few-shot)의 역할과 한계

### 예시를 넣으면 좋은 경우

- 출력 형식이 복잡하거나 생소할 때
- 용어/스타일을 고정하고 싶을 때
- 답변 길이나 톤을 맞춰야 할 때

### 예시를 과도하게 넣으면 생기는 문제

- 프롬프트 길이가 길어져 비용 증가
- 입력 텍스트보다 예시가 더 영향력 있게 작동
- 예시와 다른 케이스에서 성능 저하

따라서 **예시는 1~3개**만 사용하고, 목적을 분명히 하는 것이 좋습니다.

---

## 3. LangChain 템플릿 설계 예시

아래 코드는 **역할/목표/출력 형식/예시**를 분리해 사용하는 구조입니다. 설계 패턴은 **모듈 싱글턴**이며 템플릿을 재사용합니다.

```python
"""
목적: 프롬프트 구성 요소를 구조화하여 재사용성을 높인다.
설명: 역할/목표/예시/출력 형식을 분리한 후 템플릿을 생성한다.
디자인 패턴: 모듈 싱글턴
참조: docs/01_prompt_engineering/02_프롬프트_구성_요소와_템플릿.md
"""

from langchain_core.prompts import PromptTemplate

_prompt = """너는 {role} 역할로 동작한다.
목표: {task}

[출력 규칙]
- 출력 형식은 아래와 정확히 일치해야 한다.
{output_format}
- 예시 출력의 말투/구조/순서를 그대로 따른다.
- 추가 설명, 머리말/맺음말, 코드 블록은 금지한다.

[예시]
입력:
{example_input}
출력:
{example_output}

[실제 입력]
{context}

[주의]
- 예시의 내용은 복사하지 말고 실제 입력만 근거로 답한다.
"""
prompt = PromptTemplate(
    template=_prompt,
    input_variables=[
        "role",
        "task",
        "output_format",
        "example_input",
        "example_output",
        "context",
    ],
)
```

### 사용 예 (개념)

```python
text = prompt.format(
    role="고객 상담 요약가",
    task="상담 로그를 3줄 요약",
    output_format="요약: <3줄>\n감정: 긍정|부정|중립",
    example_input="고객: 환불 요청... 상담원: ...",
    example_output="요약: ...\n감정: 부정",
    context="고객: 배송 지연으로 불만...",
)
```

---

## 4. 프롬프트 품질을 높이는 질문

- 이 작업의 입력과 출력은 어디서/어떻게 사용되는가?
- 출력이 파싱 가능한가? 정규식으로 검증 가능한가?
- 예시가 실제 입력과 너무 다르지 않은가?
- 출력 길이 제한이 필요한가?

이 질문을 기준으로 프롬프트를 수정하면 품질이 빠르게 올라갑니다.

---

## 5. 구현 체크리스트

- 역할/목표/출력 형식을 명확히 분리했는가?
- 예시가 실제 입력과 유사하며 출력 형식을 고정하는가?
- 출력 규칙과 금지 사항이 프롬프트에 포함되어 있는가?
- 출력이 파싱 가능한 구조인지 미리 검증했는가?
